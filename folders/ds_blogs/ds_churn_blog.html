<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>Customer Churn</title>
  <!-- Bootstrap -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


  <!-- Import mapping dependencies -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"></script>
  <!-- Styling module -->
  <link rel="stylesheet" type="text/css" href='projects/la_weapon_crimes/static/css/map.css' )>

  <!-- Navbar -->
  <link rel="stylesheet" type="text/css" href='../../static/css/navbar.css' )>

  <!-- Footer -->
  <link rel="stylesheet" type="text/css" href='../../static/css/footer.css' )>

  <!-- General Themes -->
  <link rel="stylesheet" type="text/css" href='../../static/css/theme.css' )>
  <link rel="stylesheet" type="text/css" href='../../static/css/general_landing.css' )>
  <link rel="stylesheet" type="text/css" href='../../static/css/post-table.css' )>
  <link rel="stylesheet" type="text/css" href='../../static/css/code_blocks.css' )>
</head>


<body>
  <div id="page-container">
    <div id="content-wrap">
      <div w3-include-html="/folders/navbar_footer/navbar_pages.html"></div>


      <!-- all other page content -->
      <!-- Webpage title -->
      <div class="title">
        <h1>Predict customer churn using Random Forest Machine Learning.</h1>
      </div>

      <!-- Last updated -->
      <div class="date_updated">
        <p class="post-timestamp">First Posted: 12-27-2019<br>
          Last Updated: 12-31-2019</p>
      </div>

      <!-- Main container for the subfield -->
      <main class="sub-container">

        <!-- Sets up bootstrap - this page only has one row -->
        <div class="row">

          <!-- The first column of this row is size 4 - the background panel -->
          <div class="col-sm-12">

            <!-- Side panel container for background information -->
            <div class="background-panel">
              <div class="caption">
                <p>Background Info</p>
              </div>
              <div class="background-info">
                <img src="projects/customer_churn/static/images/church_image.png" alt="html" class="background-pic"
                  width="400" height="150">
                <div class="background-img-caption">
                  <p></p>
                </div>
                <p class="general-p">
                  <B>Customer Churn: </B> <br>
                  Is the proportion of customers that leave a business during a given period of time, and can be
                  calculated by: <br><br>
                  <img src="projects/customer_churn/static/images/churn_rate.png" alt="html" class="background-pic"
                    width="400" height="150">
                  <div class="background-img-caption">
                    The churn rate is closely related to the average customer life time, which is the average time a
                    customer remains active with a business before they drop off or go dormant (1).
                    These ideas can be applied to non-payment activities, such as club participation, church attendance,
                    employee turnover, or social media followers.<br>
                    <strong>Customer Churn is also known as:</strong>
                    <ul>
                      <li>Customer attrition</li>
                      <li>Customer turnover</li>
                      <li>Customer defection</li>
                    </ul>
                </p>

                <p class="general-p"><strong>Why is this important?</strong><br>
                  Understanding churn is important as it affects a businesses profitability, or the survival of
                  organizations. Surveys are often used to understand why customers either defect to the competition, go
                  dormant, or leave the market. But recent advances in machine learning libraries have made it easier
                  for business and organizations to unlock features in their organizational data, and identify features
                  that may contribute to churn. Understanding what drives churn empowers business to change business
                  practices that will keep customers.
                </p>
              </div>
              <div class="resources">
                <div class="sub-title">
                  <h4>Resources & Citations</h4>
                </div>
                <ul class="resources-ul">
                  <li><a href="https://en.wikipedia.org/wiki/Churn_rate" target="_blank">1. "Churn rate". Retrieved Dec
                      28, 2019.</a>
                  </li>
                  <li><a href="https://www.cobloom.com/blog/churn-rate-how-high-is-too-high" target="_blank">2. Law,
                      Ryan "Churn rate: How high is too high? A meta-analysis of churn studies". cobool.com. Retrieved
                      Dec 28, 2019.
                      28, 2019.</a>
                  <li><a href="https://www.worldcat.org/title/introduction-to-machine-learning-with-python-a-guide-for-data-scientists/oclc/1107796731&referer=brief_results" target="_blank">3. MuÌˆller, A. C., & Guido, S. (2018). Introduction to machine learning with Python: A guide for data scientists.
                  </a>
                  </li>
                </ul>
              </div>
            </div>



            <!-- OLD COLUMN 4 CLOSING DIV -->
            <!-- </div> -->


            <!-- SECOND COLUMN WITH MAIN CONTENT -->
            <!-- <div class="col-sm-8"> -->
            <div class="sub-section">
              <center><a href="projects/la_weapon_crimes/WeaponsCrimeProject.ipynb" download>Download Jupyter Notebook
                  File</a>
                  <a href="projects/la_weapon_crimes/static/data/LACrimeData.csv" download>Download Data
                    File</a>
                </center>
              <p class="sub-title">
                <h4>Research Objectives</h4>
                <ol>
                  <li><a href="#objective1">To describe the churn and survival rates.</a></li>
                  <li><a href="#objective2">To evaluate the distribution of the features in the dataset.</a></li>
                  <li><a href="#objective3">To compare customer features by churn status.</a></li>
                  <li><a href="#objective4">Build a machine learning model that can predict if a customer will
                      churn.</a></li>
                  <li><a href="#objective5">Evaluate the performance of the model.</a></li>
                  <li><a href="#objective6">Increase performance of model using hyperparameter tuning.</a></li>
                  <li><a href="#objective7">Identify features in the dataset that may be driving customer churn.</a>
                  </li>
                </ol>
              </p>
              <hr class="sec-div">
              <p class="sub-title">
                <h4>Methods</h4>
              </p>
              <div id="methods">
                <p class="general-p">
                  <strong><em>Data.</em></strong>
                  <br>
                  The data was obtained from datacamp.com, and is a telecommunication dataset that consists of 3333
                  instances, nineteen features (15 continuous, and 6 categorical). Each instance is a customer, and
                  includes their phone call usage, as well as whether they churned, or stayed in the company.
                  <br>
                  <br>
                  <strong><em>Analysis</em><br></strong>
                  The programming language Python was used in this project. Data was loaded and manipulated using the
                  pandas library. The
                  matplotlib, mlxtend, and seaborn libraries were used to visualize data. The sklearn libraries
                  were used to generate the machine learning algorithms.
                </p>
              </div>
              <hr class="sec-div">
              <p class="sub-title">
                <h4>Results:
                </h4>
              </p>
              <div id="objective1">
                <p class="general-p">
                  <strong><em>The customer churn rate in this dataset was 14%, while the survival rate was
                      86%.</em></strong><br>
                  The first step in this analysis is to examine how many customers cancelled their mobile service. In
                  this dataset, 14% of customers churned (Table 1). An annual study conducted in software as a service
                  companies <a
                    href="https://www.key.com/businesses-institutions/industry-expertise/technology.jsp">Pacific
                    Crest</a> reported a median annual churn rate as 10%, or 0.87% per month (2). The definition of the
                  churn rate period is important at understanding the magnitude of any number, and some would argue
                  anything above 5% would be too high. More than 1 in 10 customers did not renew their membership, and
                  for this reason, analyzing the churn rate would help the business change their business practices and
                  reduce churn.
                </p>

                <center>
                  <p class="table_title"><strong>Table 1. Customer churn rate.</strong><br>
                  </p>
                  <a href="projects/customer_churn/static/images/table_churn_rate.png">
                    <img src="projects/customer_churn/static/images/table_churn_rate.png" width="30%" height=100%
                      class=""></img></a>
                </center>
                <hr>
                <!-- CLOSING DIV OBJECTIVE -->
              </div>

              <!-- <li><a href="#objective2">To evaluate the distribution of the features in the dataset.</a></li> -->
              <div id="objective2">
                <p class="general-p">
                  <strong><em>Majority of features are normally distributed.</em></strong><br>
                  Before applying a machine learning algorithm, it is important to evaluate the distribution of the
                  data. In this dataset, 12 features are normally distributed.
                </p>
                <!-- IMAGE -->
                <center><a href="projects/customer_churn/static/images/plot_feature_distribution.png">
                    <img src="projects/customer_churn/static/images/plot_feature_distribution.png" width="75%"
                      height=100% class="figure"></img></a>
                  <p class="figure_title"><strong>Figure 1. </strong>Distributions of data by feature.
                  </p>
                </center>

              </div>
              <hr>


              <!-- <li><a href="#objective3">To compare customer features by churn status.</a></li> -->
              <div id="objective3">
                <p class="general-p">
                  <strong><em>Voicemail messages, day minutes, customer service calls, day charges, evening charges, and
                      international calls appear to be different for customers that churn.</em></strong><br>
                  To gain insight into the dataset, boxplots were generated comparing the various features in the
                  dataset between churn status. The interquartile ranges in five of the fifteen features appear to be
                  different between customers that churned, and those that did not.
                  <ul><strong>Features that appear different between groups:</strong>
                    <li>Voicemail messages: <font color="red">Lower </font> for churn customers</li>
                    <li>Day minutes: <font color="blue">Higher</font> for churn customers</li>
                    <li>Customer service calls: <font color="blue">Higher</font> for churn customers</li>
                    <li>Day charges: <font color="blue">Higher</font> for churn customers</li>
                    <li>International calls: <font color="red">Lower </font> for churn customers</li>
                  </ul>
                </p>
                <!-- IMAGE -->
                <center>
                  <a href="projects/customer_churn/static/images/plot_allfeatures_boxplot.png">
                    <img src="projects/customer_churn/static/images/plot_allfeatures_boxplot.png" width="100%"
                      height=100% class="figure"></img></a>
                  <p class="figure_title"><strong>Figure 2. </strong> Distribution of features by customer churn status.
                  </p>
                </center>
              </div>
              <hr>
              <!-- <li><a href="#objective4">Build a machine learning model that can predict if a customer will
                  churn.</a></li>               -->
              <div id="objective4">
                <p class="general-p">
                  <strong><em>Random forest classification using random_state = 0 had a 0.991 accuracy on training set,
                      and 0.910 on test set.</em></strong><br>
                  The supervised learning model random forests was used to to predict customer churn because it is a very
                  powerful model that and can perform without requiring scaling of data, or heavy hyperparameter tuning (3).  An evaluation of a single decision tree from this forest can have a depth greater than 20 (Figure 3).  The accuracy on the training set was 0.991, while the accuracy on the test set was 0.910.  The difference in accuracy between training and test sets was 0.081.
                </p>
                <!-- IMAGE -->
                <center>
                <a href="projects/customer_churn/static/images/untuned_tree_from_forest.png">
                  <img src="projects/customer_churn/static/images/untuned_tree_from_forest.png"
                    width="100%" height=100% class="figure"></img></a>
                <p class="figure_title"><strong>Figure 3. </strong> Visualization of a single decision tree built from an untuned Random Forest Model fit to the churn dataset.
                </p>
              </center>
              </div>
              <hr>
              <!-- <li><a href="#objective5">Evaluate the performance of the model.</a></li>               -->
              <div id="objective5">
                <p class="general-p">
                  <strong><em>Untuned model had high precision but low recall at classifying customers that churn.</em></strong><br>
                  The model was able to classify customers that did not churn with an accuracy and precision greater than > 0.90 (Figure 4, Figure 5, Table 2), although when evaluating how well the model performed at classifying customer that churned, that was much lower for recall, with a precision score of 41% (Figure 4, Table 2).  This means that although the model was able to classify customers that churned, it did so at much lower levels.  This may be due to the fact that there is a class imbalance, as only 14% of the dataset are have churned. <br><br>
                  <strong><em>Untuned model suggests that day minutes, customer service calls, and the international plans were the top 3 features.</em></strong><br>
                  The power of a decision tree (Figure 3) is that it allows one to identify important features that drive some event.  In this case, when customers drop their voicemail plan.  But as figure 3 highlights, gathering this information can be monumental when the depth > 10.  As a result, a feature importance analysis was conducted (Figure 6), this method ranks how important each feature is for the decision tree, and the numbers each feature is assigned ranges from 0 - 1, with the total sum of equal to 1 (3).  In this untuned random forest model, the top 3 ranked features were 1) day minutes, 2) customer service calls, 3) and international plans.  These three would be top priorities for the business to address in order to reduce, or even reverse, customer churn. But before any new business rules are implemented, it is important to try some hyperparameter tuning to improve the recall.
                </p>

                <center>
                <!-- IMAGE -->
                <a href="projects/customer_churn/static/images/plot_untuned_randomforest_confusion_matrix.png">
                  <img src="projects/customer_churn/static/images/plot_untuned_randomforest_confusion_matrix.png"
                    width="50%" height=100% class="figure"></img></a>
                <p class="figure_title"><strong>Figure 4. </strong> Confusion matrix for untuned Random Forest Classier fit to the churn dataset.
                </p>
              </center>

              <center>
                <!-- IMAGE -->
                <a href="projects/customer_churn/static/images/plot_untuned_randomforest_ROC.png">
                  <img src="projects/customer_churn/static/images/plot_untuned_randomforest_ROC.png" width="50%"
                    height=100% class="figure"></img></a>
                <p class="figure_title"><strong>Figure 5. </strong> Feature importance computed from the untuned Random Forest Classier fit to the churn dataset.
                </p>
              </center>

                <center>
                    <p class="table_title"><strong>Table 2. Classification Report for Untuned Random Forest Model fit to Churn Dataset.</strong><br>
                    </p>
                    <a href="projects/customer_churn/static/images/table_untuned_classification_report.png">
                      <img src="projects/customer_churn/static/images/table_untuned_classification_report.png" width="50%" height=100%
                        class=""></img></a>
                  </center>
                
                  <center>
                      <!-- IMAGE -->
                      <a href="projects/customer_churn/static/images/plot_untuned_randomforest_features.png">
                        <img src="projects/customer_churn/static/images/plot_untuned_randomforest_features.png" width="50%"
                          height=100% class="figure"></img></a>
                      <p class="figure_title"><strong>Figure 6. </strong> Feature importance computed from the untuned Random Forest Classier fit to the churn dataset.
                      </p>
                    </center>

                <!-- CLOSING DIV FOR OBJECTIVE -->
              </div>
              <hr>

              <!-- <li><a href="#objective6">Increase performance of model using hyperparameter tuning.</a></li>                 -->
              <div id="objective6">
                <p class="general-p">
                  <strong><em>Hyperparameter tuning of the Random Forest classifier improved the recall of the model to by 20%, and the F1-Score for churn by 18%</em></strong><br>
                  To tune the model, GridSearchCV was used to identify the optimal parameters for the following: 
                  <ul>
                    <li>"n_estimators" : np.arange(10,51)</li>
                    <li>"max_features": ['auto', 'sqrt', 'log2']</li>
                    <li>"max_depth": [3, None]</li>
                    <li>"max_features": [1, 3, 10]</li>
                    <li>"bootstrap": [True, False]</li>
                    <li>"criterion": ["gini", "entropy"]</li>
                  </ul>
                  The optimal paramters (bootstrap=False, criterion='gini', 
                  max_depth=None, max_features=10, n_estimators=33) were used to build a new tuned Random Forest Classifer. Accuracy for the tuned model training set was 1.000, and the accuracy for the tuned model test set was 0.944, The difference in accuracy between the model training and test sets was 0.056, which was an improvement from the untuned model which had a difference of 0.081.  The model produced a depth greater than 15 (Figure 7), and more importantly, improved the precision and recall scores for both customers that churn, and those that did not (Figure 8, Figure 9, Table 3).  The precision for churners increased by 6%, while the recall for churners increased by 20%, and the F1 score for this class increased by 18%, as compared to the untuned model.  Taken together, these results suggest that using the recommendation by GridSearchCV increased the classifying and prediction of customers that dropped there services.  
                <center>
                <!-- IMAGE -->
                <a href="projects/customer_churn/static/images/tuned_tree_from_forest.png">
                  <img src="projects/customer_churn/static/images/tuned_tree_from_forest.png"
                    width="100%" height=100% class="figure"></img></a>
                <p class="figure_title"><strong>Figure 7. </strong> Visualization of a single decision tree built from a tuned Random Forest Model.
                  </p>
                </center>
                <center>
                <!-- IMAGE -->
                <a href="projects/customer_churn/static/images/plot_finetuned_randomforest_confusion_matrix.png">
                  <img src="projects/customer_churn/static/images/plot_finetuned_randomforest_confusion_matrix.png"
                    width="50%" height=100% class="figure"></img></a>
                <p class="figure_title"><strong>Figure 8. </strong> Post hyperparameter tuning ROC.
                </p>
              </center>

              <center>
                <!-- IMAGE -->
                <a href="projects/customer_churn/static/images/plot_tuned_randomforest_ROC.png">
                  <img src="projects/customer_churn/static/images/plot_tuned_randomforest_ROC.png" width="50%"
                    height=100% class="figure"></img></a>
                <p class="figure_title"><strong>Figure 9. </strong> ROC post model tuning.
                </p>
              </center>

                <center>
                    <p class="table_title"><strong>Table 3. Classification Report for tuned Random Forest Model fit to Churn Dataset.</strong><br>
                    </p>
                    <a href="projects/customer_churn/static/images/table_tuned_classification_report.png">
                      <img src="projects/customer_churn/static/images/table_tuned_classification_report.png" width="50%" height=100%
                        class=""></img></a>
                  </center>
              </div>
<hr>
              <div id="objective7">
                <p class="general-p">
                  <strong><em>Business plans should address issues with day minutes, customer service calls, and international.</em></strong><br>
                </p>
                Now that we have a model with greater performance (I'm sure there are additional changes that can improve the recall for churners), we can safely identify at least 3 features that seem to drive this phenomenon, day minutes, customer service calls, and international plans. Armed with this information, the next step for the business would be to survey both customer service staff, and customers that left to identify issues in these areas that can serve as a foundation for business plan changes.
              </p>
                <center>
                <!-- IMAGE -->
                <a href="projects/customer_churn/static/images/plot_tuned_randomforest_features.png">
                  <img src="projects/customer_churn/static/images/plot_tuned_randomforest_features.png" width="50%"
                    height=100% class="figure"></img></a>
                <p class="figure_title"><strong>Figure 10. </strong> Feature importance computed from the tuned Random Forest Classier fit to the churn dataset.
                </p>
              </center>
              </div>

              <!-- CLOSING DIV FOR SUB-SECTION -->
            </div>


            <!-- ################################ DO NOT ENTER ########################## -->
            <div class="sub-entry">
              <div w3-include-html="ds_blogs_table.html"></div>
            </div>
          </div>
          <!-- Div for the bootstrap row -->
        </div>
        <!-- CLOSING MAIN -->
      </main>
      <!-- CLOSING DIV FOR CONTENT-WRAPPER -->
    </div>
    <!--This div for footer-page div-->
    <div w3-include-html="/folders/navbar_footer/footer.html"></div>
    <!-- CLOSING DIV FOR PAGE-CONTAINER -->
  </div>

  <!-- THESE ARE KEY FOR THE D3JS -->
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <!-- THIS IS TO ADD THE HEADER AND FOOTER -->
  <script type="text/javascript" src="../../static/js/include.js"></script>
  <!-- Mapping js -->
  <script type="text/javascript" src="projects/la_weapon_crimes/static/js/mapping.js"></script>
</body>

</html>