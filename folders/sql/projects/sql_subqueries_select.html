<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Import-Dependencies">Import Dependencies<a class="anchor-link" href="#Import-Dependencies">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">create_engine</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_rows&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Connect to sqlite database</span>
<span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:////filepath/soccer.sqlite&quot;</span><span class="p">,</span> <span class="n">echo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Confirm connection by printing tables</span>
<span class="n">engine</span><span class="o">.</span><span class="n">table_names</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[&#39;Country&#39;,
 &#39;League&#39;,
 &#39;Match&#39;,
 &#39;Player&#39;,
 &#39;Player_Attributes&#39;,
 &#39;Team&#39;,
 &#39;Team_Attributes&#39;,
 &#39;sqlite_sequence&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Examine-Data">Examine Data<a class="anchor-link" href="#Examine-Data">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sql_view</span> <span class="o">=</span> <span class="s2">&quot;SELECT * FROM Match LIMIT 3;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Run query</span>
<span class="n">view_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_view</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="c1"># Displaying data</span>
<span class="n">view_data</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>country_id</th>
      <th>league_id</th>
      <th>season</th>
      <th>stage</th>
      <th>date</th>
      <th>match_api_id</th>
      <th>home_team_api_id</th>
      <th>away_team_api_id</th>
      <th>home_team_goal</th>
      <th>away_team_goal</th>
      <th>home_player_X1</th>
      <th>home_player_X2</th>
      <th>home_player_X3</th>
      <th>home_player_X4</th>
      <th>home_player_X5</th>
      <th>home_player_X6</th>
      <th>home_player_X7</th>
      <th>home_player_X8</th>
      <th>home_player_X9</th>
      <th>home_player_X10</th>
      <th>home_player_X11</th>
      <th>away_player_X1</th>
      <th>away_player_X2</th>
      <th>away_player_X3</th>
      <th>away_player_X4</th>
      <th>away_player_X5</th>
      <th>away_player_X6</th>
      <th>away_player_X7</th>
      <th>away_player_X8</th>
      <th>away_player_X9</th>
      <th>away_player_X10</th>
      <th>away_player_X11</th>
      <th>home_player_Y1</th>
      <th>home_player_Y2</th>
      <th>home_player_Y3</th>
      <th>home_player_Y4</th>
      <th>home_player_Y5</th>
      <th>home_player_Y6</th>
      <th>home_player_Y7</th>
      <th>home_player_Y8</th>
      <th>home_player_Y9</th>
      <th>home_player_Y10</th>
      <th>home_player_Y11</th>
      <th>away_player_Y1</th>
      <th>away_player_Y2</th>
      <th>away_player_Y3</th>
      <th>away_player_Y4</th>
      <th>away_player_Y5</th>
      <th>away_player_Y6</th>
      <th>away_player_Y7</th>
      <th>away_player_Y8</th>
      <th>away_player_Y9</th>
      <th>away_player_Y10</th>
      <th>away_player_Y11</th>
      <th>home_player_1</th>
      <th>home_player_2</th>
      <th>home_player_3</th>
      <th>home_player_4</th>
      <th>home_player_5</th>
      <th>home_player_6</th>
      <th>home_player_7</th>
      <th>home_player_8</th>
      <th>home_player_9</th>
      <th>home_player_10</th>
      <th>home_player_11</th>
      <th>away_player_1</th>
      <th>away_player_2</th>
      <th>away_player_3</th>
      <th>away_player_4</th>
      <th>away_player_5</th>
      <th>away_player_6</th>
      <th>away_player_7</th>
      <th>away_player_8</th>
      <th>away_player_9</th>
      <th>away_player_10</th>
      <th>away_player_11</th>
      <th>goal</th>
      <th>shoton</th>
      <th>shotoff</th>
      <th>foulcommit</th>
      <th>card</th>
      <th>cross</th>
      <th>corner</th>
      <th>possession</th>
      <th>B365H</th>
      <th>B365D</th>
      <th>B365A</th>
      <th>BWH</th>
      <th>BWD</th>
      <th>BWA</th>
      <th>IWH</th>
      <th>IWD</th>
      <th>IWA</th>
      <th>LBH</th>
      <th>LBD</th>
      <th>LBA</th>
      <th>PSH</th>
      <th>PSD</th>
      <th>PSA</th>
      <th>WHH</th>
      <th>WHD</th>
      <th>WHA</th>
      <th>SJH</th>
      <th>SJD</th>
      <th>SJA</th>
      <th>VCH</th>
      <th>VCD</th>
      <th>VCA</th>
      <th>GBH</th>
      <th>GBD</th>
      <th>GBA</th>
      <th>BSH</th>
      <th>BSD</th>
      <th>BSA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-17 00:00:00</td>
      <td>492473</td>
      <td>9987</td>
      <td>9993</td>
      <td>1</td>
      <td>1</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>1.73</td>
      <td>3.4</td>
      <td>5.00</td>
      <td>1.75</td>
      <td>3.35</td>
      <td>4.20</td>
      <td>1.85</td>
      <td>3.2</td>
      <td>3.5</td>
      <td>1.8</td>
      <td>3.3</td>
      <td>3.75</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>1.70</td>
      <td>3.30</td>
      <td>4.33</td>
      <td>1.90</td>
      <td>3.3</td>
      <td>4.0</td>
      <td>1.65</td>
      <td>3.40</td>
      <td>4.50</td>
      <td>1.78</td>
      <td>3.25</td>
      <td>4.00</td>
      <td>1.73</td>
      <td>3.40</td>
      <td>4.20</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>1</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-16 00:00:00</td>
      <td>492474</td>
      <td>10000</td>
      <td>9994</td>
      <td>0</td>
      <td>0</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>1.95</td>
      <td>3.2</td>
      <td>3.60</td>
      <td>1.80</td>
      <td>3.30</td>
      <td>3.95</td>
      <td>1.90</td>
      <td>3.2</td>
      <td>3.5</td>
      <td>1.9</td>
      <td>3.2</td>
      <td>3.50</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>1.83</td>
      <td>3.30</td>
      <td>3.60</td>
      <td>1.95</td>
      <td>3.3</td>
      <td>3.8</td>
      <td>2.00</td>
      <td>3.25</td>
      <td>3.25</td>
      <td>1.85</td>
      <td>3.25</td>
      <td>3.75</td>
      <td>1.91</td>
      <td>3.25</td>
      <td>3.60</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-16 00:00:00</td>
      <td>492475</td>
      <td>9984</td>
      <td>8635</td>
      <td>0</td>
      <td>3</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>2.38</td>
      <td>3.3</td>
      <td>2.75</td>
      <td>2.40</td>
      <td>3.30</td>
      <td>2.55</td>
      <td>2.60</td>
      <td>3.1</td>
      <td>2.3</td>
      <td>2.5</td>
      <td>3.2</td>
      <td>2.50</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>2.50</td>
      <td>3.25</td>
      <td>2.40</td>
      <td>2.63</td>
      <td>3.3</td>
      <td>2.5</td>
      <td>2.35</td>
      <td>3.25</td>
      <td>2.65</td>
      <td>2.50</td>
      <td>3.20</td>
      <td>2.50</td>
      <td>2.30</td>
      <td>3.20</td>
      <td>2.75</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Example-1:-Simple-Subsquery-in-SELECT-Clause">Example 1: Simple Subsquery in <font color="red">SELECT</font> Clause<a class="anchor-link" href="#Example-1:-Simple-Subsquery-in-SELECT-Clause">&#182;</a></h1><p><strong>Generic Synthax</strong><br>
SELECT column(s)<br>
FROM subquery<br>
WHERE conditions;<br></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2><font color="blue">Goal: </font><br>Create a table that compares the average goals scores by a league to the overall average goals scored.</h2>
<h2>Step 1: <br>Create the Inner Query</h2>
<h3 id="Retrieve-the-overall-average-goals-scored-in-the-2012-2013-season">Retrieve the overall average goals scored in the 2012-2013 season<a class="anchor-link" href="#Retrieve-the-overall-average-goals-scored-in-the-2012-2013-season">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sql_subquery1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT ROUND(AVG(home_team_goal + away_team_goal), 2) AS &#39;overall_average&#39;</span>
<span class="s2">                 FROM Match</span>
<span class="s2">                 WHERE season = &#39;2012/2013&#39;;&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Run query</span>
<span class="n">subquery1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_subquery1</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="c1"># Displaying data</span>
<span class="n">subquery1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>overall_average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.77</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><font color="blue">Note:</font><br>
This query returned a calculated aggregated value.<br>
It also only returned a single value.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Step-2:-Place-the-Subquery-in-the-Main-Query-SELECT-Clause.">Step 2: Place the Subquery in the Main Query <code>SELECT</code> Clause.<a class="anchor-link" href="#Step-2:-Place-the-Subquery-in-the-Main-Query-SELECT-Clause.">&#182;</a></h2><ul>
<li>Make sure to use the same filter conditions in the main query that was used in the subquery.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sql_outter1</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT l.name AS league,</span>
<span class="s2">                ROUND(AVG(m.home_team_goal + m.away_team_goal), 2) AS avg_goals,</span>
<span class="s2">                (SELECT ROUND(AVG(home_team_goal + away_team_goal), 2)</span>
<span class="s2">                    FROM Match</span>
<span class="s2">                    WHERE season = &#39;2012/2013&#39;) AS overall_avg</span>
<span class="s2">                FROM League as l</span>
<span class="s2">                LEFT JOIN Match as m</span>
<span class="s2">                ON l.country_id = m.country_id</span>
<span class="s2">                WHERE season = &#39;2012/2013&#39;</span>
<span class="s2">                GROUP BY league</span>
<span class="s2">                ORDER BY avg_goals DESC</span>
<span class="s2">                LIMIT 5;</span>
<span class="s2">                &quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Step-3:-Display-Query-Result">Step 3: Display Query Result<a class="anchor-link" href="#Step-3:-Display-Query-Result">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Run query</span>
<span class="n">view_data1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_outter1</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="c1"># Displaying data</span>
<span class="n">view_data1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>league</th>
      <th>avg_goals</th>
      <th>overall_avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Netherlands Eredivisie</td>
      <td>3.15</td>
      <td>2.77</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Belgium Jupiler League</td>
      <td>2.93</td>
      <td>2.77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Germany 1. Bundesliga</td>
      <td>2.93</td>
      <td>2.77</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Spain LIGA BBVA</td>
      <td>2.87</td>
      <td>2.77</td>
    </tr>
    <tr>
      <th>4</th>
      <td>England Premier League</td>
      <td>2.80</td>
      <td>2.77</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-Outcome-The-five-leagues-with-average-goals-&gt;-than-the-average-overall-goals-in-2012/2013-season-were:"><font color="blue">The Outcome</font> The five leagues with average goals &gt; than the average overall goals in 2012/2013 season were:<a class="anchor-link" href="#The-Outcome-The-five-leagues-with-average-goals-&gt;-than-the-average-overall-goals-in-2012/2013-season-were:">&#182;</a></h2><ol>
    <li>Netherlands</li>
    <li>Belgium Jupiler League</li>
    <li>Germany 1. Bundesliga   </li>
    <li>Spain LIGA BBVA</li>
    <li>England Premier league</li>    
</ol>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3><font color="blue">Explanation:</font><br></h3>
<p><strong>The INNER Subquery</strong><br>
<code>SELECT ROUND(AVG(home_team_goal + away_team_goal), 2) AS 'overall_average'
FROM Match
WHERE season = '2012/2013'</code>
<br>
This subquery selects the columns <br></p>
<ol>
<li>from Match table: home_team_goal and away_team_goal are selected</li>
<li>The WHERE clause returns the rows where seasons = '2012/2013' </li>
<li>It them calculates the average by adding these two columns</li>
<li>The returned value is rounded to 2 decimal places</li>
<li>The output is labeled 'overall_average'
<br>
<br>
<strong>The MAIN query</strong><br>
<code>SELECT l.name AS league,
ROUND(AVG(m.home_team_goal + m.away_team_goal), 2) AS avg_goals,
overall_avg #this was redacted for simplicity (inner query code)
FROM League as l
LEFT JOIN Match as m
ON l.country_id = m.country_id
WHERE season = '2012/2013'
GROUP BY league
ORDER BY avg_goals DESC
LIMIT 5;</code>
<br>
<br></li>
</ol>
<p><strong>SELECT Statement</strong>
The MAIN query selected the following columns<br></p>
<ol>
<li><code>l.name AS league</code><br></li>
<li><code>overall_avg</code> from inner subquery
<br>
<strong>Tables and Join Used</strong></li>
<li><code>League as l</code><br> Main table is League and is aliased as 'l'</li>
<li><code>LEFT JOIN Match as m</code> This code merges data from tge Match table to League table</li>
<li><code>ON l.country_id = m.country_id</code>This specifies which columns will be used for the merger.
<br>
<strong>Filtering Steps with WHERE clause</strong>
The main query then filteres by the <code>WHERE</code> clause, and returns all instances where the <code>season</code> contains '2012/2013'.
<strong>Data Organization and return limits</strong></li>
<li><code>GROUP BY league</code><br> This will aggregate rows by the league value</li>
<li><code>ORDER BY avg_goals DESC</code> This will sort the data by avg_goals column in descending value</li>
<li><code>LIMIT 5</code> This will dispaly only 5 instances.</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="What-to-remember">What to remember<a class="anchor-link" href="#What-to-remember">&#182;</a></h2><ul>
<li>Make sure the filter conditions are consistent in the main and in the inner query.</li>
<li>Subqueries in SELECT clause return a single aggregated value</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Example-2:-Conducting-Calculations-in-SELECT-Subqueries">Example 2: Conducting Calculations in <font color="red">SELECT</font> Subqueries<a class="anchor-link" href="#Example-2:-Conducting-Calculations-in-SELECT-Subqueries">&#182;</a></h1><p><strong>Generic Synthax</strong><br>
SELECT column(s), calcualation involving subquery<br>
FROM table(s);<br></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2><font color="blue">Goal: </font><br>Create a table that adds a column that directly compares the average goals scored by a league to the total overall average goal, by subtracting the overall average from the subquery.</h2>
<h2>Step 1: <br>Create the Inner Query</h2>
<h3 id="Retrieve-the-overall-average-goals-scored-in-the-2012-2013-season">Retrieve the overall average goals scored in the 2012-2013 season<a class="anchor-link" href="#Retrieve-the-overall-average-goals-scored-in-the-2012-2013-season">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sql_subquery2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT AVG(home_team_goal + away_team_goal) AS overall_average</span>
<span class="s2">                    FROM Match </span>
<span class="s2">                    WHERE season = &#39;2012/2013&#39;;&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Run query</span>
<span class="n">subquery2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_subquery2</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="c1"># Displaying data</span>
<span class="n">subquery2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[11]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>overall_average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2.772699</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Step-2:-Perform-calculation-on-the-SELECT-Clause-Subquery-in-the-Main-Query-.">Step 2: Perform calculation on the <code>SELECT</code> Clause Subquery in the Main Query .<a class="anchor-link" href="#Step-2:-Perform-calculation-on-the-SELECT-Clause-Subquery-in-the-Main-Query-.">&#182;</a></h2><ul>
<li>Make sure to use the same filter conditions in the main query that was used in the subquery.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sql_outter2</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                SELECT l.name AS league,</span>
<span class="s2">                ROUND(AVG(m.home_team_goal + m.away_team_goal),2) AS avg_goals,</span>
<span class="s2">                ROUND(AVG(m.home_team_goal + m.away_team_goal) - </span>
<span class="s2">                (SELECT AVG(home_team_goal + away_team_goal)</span>
<span class="s2">                FROM Match </span>
<span class="s2">                WHERE season = &#39;2012/2013&#39;),2) AS diff</span>
<span class="s2">                FROM League AS l</span>
<span class="s2">                LEFT JOIN Match AS m</span>
<span class="s2">                ON l.country_id = m.country_id</span>
<span class="s2">                -- Only include 2012/2013 results</span>
<span class="s2">                WHERE season = &#39;2012/2013&#39;</span>
<span class="s2">                GROUP BY l.name;&quot;&quot;&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Step-3:-Display-Query-Result">Step 3: Display Query Result<a class="anchor-link" href="#Step-3:-Display-Query-Result">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Run query</span>
<span class="n">view_data1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_outter2</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="c1"># Displaying data</span>
<span class="n">view_data1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[13]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>league</th>
      <th>avg_goals</th>
      <th>diff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Belgium Jupiler League</td>
      <td>2.93</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>England Premier League</td>
      <td>2.80</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>2</th>
      <td>France Ligue 1</td>
      <td>2.54</td>
      <td>-0.23</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Germany 1. Bundesliga</td>
      <td>2.93</td>
      <td>0.16</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Italy Serie A</td>
      <td>2.64</td>
      <td>-0.13</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Netherlands Eredivisie</td>
      <td>3.15</td>
      <td>0.38</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Poland Ekstraklasa</td>
      <td>2.49</td>
      <td>-0.28</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Portugal Liga ZON Sagres</td>
      <td>2.78</td>
      <td>0.01</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Scotland Premier League</td>
      <td>2.73</td>
      <td>-0.04</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Spain LIGA BBVA</td>
      <td>2.87</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Switzerland Super League</td>
      <td>2.57</td>
      <td>-0.21</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3><font color="blue">Explanation:</font><br></h3>
<p><strong>The INNER Subquery</strong><br>
<code>SELECT AVG(home_team_goal + away_team_goal) AS overall_average
FROM Match 
WHERE season = '2012/2013'</code>
<br>
This subquery selects the columns home_team_goal and away_team_goal <br></p>
<ol>
<li>from Match table: home_team_goal and away_team_goal are selected</li>
<li>The WHERE clause returns the rows where seasons = '2012/2013' </li>
<li>It them calculates the average by adding these two columns</li>
<li>The output is labeled 'overall_average'
<br>
<br>
<strong>The MAIN query</strong><br>
<code>SELECT l.name AS league,
ROUND(AVG(m.home_team_goal + m.away_team_goal),2) AS avg_goals,
ROUND(AVG(m.home_team_goal + m.away_team_goal) - 
(SELECT AVG(home_team_goal + away_team_goal)
FROM Match 
WHERE season = '2012/2013'),2) AS diff
FROM League AS l
LEFT JOIN Match AS m
ON l.country_id = m.country_id
-- Only include 2012/2013 results
WHERE season = '2012/2013'
GROUP BY league;</code>
<br>
<br>
<strong>SELECT Statement</strong>
The MAIN query selected the following columns<br></li>
<li><code>l.name AS league</code><br></li>
<li><code>ROUND(AVG(m.home_team_goal + m.away_team_goal),2) AS avg_goals</code> calculated field from the Match table</li>
<li><strong>Step that performs calculation on subquery, and creates a new column: </strong><br>
Simplified:
<code>ROUND(AVG(m.home_team_goal + m.away_team_goal) - subquery AS diff</code><br>
Full length:
<code>ROUND(AVG(m.home_team_goal + m.away_team_goal) - 
(SELECT AVG(home_team_goal + away_team_goal)
FROM Match 
WHERE season = '2012/2013'),2) AS diff</code><br>
<br>
<strong>Tables and Join Used</strong></li>
<li><code>League as l</code><br> Main table is League and is aliased as 'l'</li>
<li><code>LEFT JOIN Match as m</code> This code merges data from the Match table to League table</li>
<li><code>ON l.country_id = m.country_id</code>This specifies which columns will be used for the merger.
<br>
<strong>Filtering Steps with WHERE clause</strong>
The main query then filteres by the <code>WHERE</code> clause, and returns all instances where the <code>season</code> contains '2012/2013'.
<strong>Data Organization and return limits</strong></li>
<li><code>GROUP BY league</code><br> This will aggregate rows by the league value</li>
</ol>

</div>
</div>
</div>
 

